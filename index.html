<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sign In</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Geist:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    * { font-family: 'Geist', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; }

    :root {
      --bg-primary: #000000;
      --bg-secondary: #0a0a0a;
      --text-primary: #ffffff;
      --text-secondary: #a0a0a0;
      --accent-primary: #4f46e5;
      --accent-secondary: #06b6d4;
      --border-color: rgba(255, 255, 255, 0.08);
    }

    body { background-color: var(--bg-primary); color: var(--text-primary); overflow-x: hidden; }
    .glass-card { background: linear-gradient(135deg, rgba(255,255,255,0.06) 0%, rgba(255,255,255,0.02) 100%); backdrop-filter: blur(12px); border:1px solid var(--border-color); box-shadow: 0 8px 32px rgba(0,0,0,0.5), inset 0 1px 1px rgba(255,255,255,0.08); }
    .neumorphic-input { background: linear-gradient(135deg, rgba(255,255,255,0.08) 0%, rgba(255,255,255,0.04) 100%); border:1px solid var(--border-color); box-shadow: inset 0 2px 4px rgba(0,0,0,0.3), inset 0 -1px 2px rgba(255,255,255,0.04); color: var(--text-primary); transition: all 0.3s ease; font-size: 0.95rem; }
    .neumorphic-input::placeholder { color: var(--text-secondary); }
    .neumorphic-input:focus { outline: none; background: linear-gradient(135deg, rgba(79,70,229,0.1) 0%, rgba(6,182,212,0.05) 100%); border-color: rgba(79,70,229,0.4); box-shadow: inset 0 2px 4px rgba(0,0,0,0.3), 0 0 24px rgba(79,70,229,0.2); }

    .login-button { background: linear-gradient(135deg,#4f46e5 0%,#06b6d4 100%); border:1px solid rgba(79,70,229,0.5); color: var(--text-primary); font-weight:600; transition: all 0.3s cubic-bezier(0.4,0,0.2,1); box-shadow:0 12px 24px rgba(79,70,229,0.25), inset 0 1px 1px rgba(255,255,255,0.15); letter-spacing:-0.01em; cursor:pointer; position:relative; overflow:hidden; }
    .login-button:hover:not(:disabled) { background: linear-gradient(135deg,#5f56f5 0%,#16c6d4 100%); box-shadow:0 16px 32px rgba(79,70,229,0.35), inset 0 1px 1px rgba(255,255,255,0.15); transform: translateY(-2px);}
    .login-button:active:not(:disabled) { transform: translateY(0); box-shadow:0 6px 12px rgba(79,70,229,0.15), inset 0 2px 4px rgba(0,0,0,0.2); }
    .login-button:disabled { opacity:0.6; cursor:not-allowed; }

    .footer-link { color: var(--text-secondary); font-size:0.875rem; cursor:pointer; border:none; background:none; padding:0; position:relative; }
    .footer-link::after { content:''; position:absolute; bottom:-2px; left:0; width:0; height:1px; background:linear-gradient(90deg,#4f46e5,#06b6d4); transition:width 0.3s ease; }
    .footer-link:hover { color:#4f46e5; }
    .footer-link:hover::after { width:100%; }

    .avatar-placeholder { background: linear-gradient(135deg, rgba(79,70,229,0.15) 0%, rgba(6,182,212,0.1) 100%); border:1px solid rgba(79,70,229,0.2); box-shadow: inset 0 2px 4px rgba(0,0,0,0.3), 0 0 24px rgba(79,70,229,0.1); }
    .sign-in-title { font-size:2.5rem; font-weight:700; color:var(--text-primary); letter-spacing:-0.02em; background: linear-gradient(135deg, #ffffff 0%, #a0a0a0 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
    .subtitle { font-size:0.95rem; color:var(--text-secondary); margin-top:0.5rem; letter-spacing:0.01em; }

    @keyframes fadeInUp { from { opacity:0; transform:translateY(24px);} to{opacity:1; transform:translateY(0);} }
    .card-animation { animation: fadeInUp 0.7s ease-out; }
    .input-group { animation: fadeInUp 0.7s ease-out; animation-fill-mode:both; }
    .input-group:nth-child(1){animation-delay:0.1s;}
    .input-group:nth-child(2){animation-delay:0.2s;}
    .button-group { animation:fadeInUp 0.7s ease-out; animation-delay:0.3s; animation-fill-mode:both; }
    .footer-group { animation:fadeInUp 0.7s ease-out; animation-delay:0.4s; animation-fill-mode:both; }

    @keyframes spin { to { transform:rotate(360deg); } }
    .spin { animation: spin 1s linear infinite; }
  </style>
</head>
<body class="min-h-screen bg-black flex items-center justify-center p-4 md:p-6">
  <div class="w-full flex flex-col items-center">
    <div class="mb-8 text-center md:mb-12">
      <h1 class="sign-in-title">Welcome Back</h1>
      <p class="subtitle">Sign in to your account to continue</p>
    </div>

    <div class="card-animation w-full max-w-md glass-card rounded-2xl p-8 md:p-10">
      <div class="flex flex-col items-center">
        <div class="avatar-placeholder w-16 h-16 rounded-full flex items-center justify-center mb-8">
          <svg class="w-8 h-8 text-indigo-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
          </svg>
        </div>

        <form id="loginForm" class="w-full space-y-5">
          <div class="input-group relative">
            <label for="user" class="block text-xs font-semibold text-text-secondary mb-2 opacity-70">currentUser</label>
            <input type="text" id="email" placeholder="Username" class="neumorphic-input w-full px-6 py-4 rounded-2xl" required />
          </div>

          <div class="input-group relative">
            <label for="password" class="block text-xs font-semibold text-text-secondary mb-2 opacity-70">PASSWORD</label>
            <input type="password" id="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" class="neumorphic-input w-full px-4 py-3 rounded-lg" required />
          </div>

          <div class="button-group pt-2">
            <button type="submit" id="loginBtn" class="login-button w-full py-3 rounded-lg text-sm font-semibold flex items-center justify-center gap-2">
              <span id="btnText">Sign In</span>
              <span id="spinner" class="hidden">
                <svg class="spin h-4 w-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                  <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="3"></circle>
                  <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
              </span>
            </button>
          </div>
        </form>

        <div class="w-full h-px bg-gradient-to-r from-transparent via-white/10 to-transparent my-6"></div>

        <div class="footer-group flex flex-col sm:flex-row justify-between items-center gap-4 text-sm w-full">
          <button class="footer-link">Forgot password?</button>
          <span class="text-xs text-text-secondary">Don't have an account? <button class="footer-link">Sign up</button></span>
        </div>
      </div>
    </div>
  </div>

  <script>
    console.log('üöÄ Login page loaded');
    
    // Check if user is already authenticated
    chrome.storage.local.get(['authenticated', 'user'], (result) => {
      console.log('üîç Checking authentication:', result);
      
      if (result.authenticated && result.user) {
        console.log('‚úÖ User already authenticated:', result.user);
        document.body.innerHTML = `
          <div class="min-h-screen bg-black flex items-center justify-center p-4">
            <div class="text-center">
              <div class="mb-8">
                <svg class="w-16 h-16 text-green-400 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
              </div>
              <h2 class="text-2xl font-bold text-white mb-2">Already Logged In</h2>
              <p class="text-gray-400 mb-6">Welcome back, ${result.user.username}!</p>
              <button onclick="logout()" class="px-6 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors">
                Logout
              </button>
            </div>
          </div>
        `;
      } else {
        console.log('‚ùå User not authenticated, showing login form');
      }
    });

    function logout() {
      console.log('üö™ Logout button clicked');
      chrome.runtime.sendMessage({ action: 'logout' }, (response) => {
        console.log('üì§ Logout response:', response);
        if (response && response.success) {
          console.log('‚úÖ Logout successful, reloading page');
          location.reload();
        }
      });
    }

    const form = document.getElementById('loginForm');
    const emailInput = document.getElementById('email');
    const passwordInput = document.getElementById('password');
    const loginBtn = document.getElementById('loginBtn');
    const btnText = document.getElementById('btnText');
    const spinner = document.getElementById('spinner');

    console.log('üìù Login form elements found:', {
      form: !!form,
      emailInput: !!emailInput,
      passwordInput: !!passwordInput,
      loginBtn: !!loginBtn,
      btnText: !!btnText,
      spinner: !!spinner
    });

    form.addEventListener('submit', async (e) => {
      console.log('üîê Login form submitted');
      e.preventDefault();

      const email = emailInput.value.trim();
      const password = passwordInput.value.trim();

      console.log('üìß Form data:', { email, password: '***' });

      if (!email || !password) {
        console.log('‚ö†Ô∏è Validation failed: empty fields');
        alert('Please fill in both fields');
        return;
      }

      if (email === 'Travis Scott' && password === 'MBDTF') {
        console.log('‚úÖ Credentials correct, authenticating...');
        loginBtn.disabled = true;
        btnText.textContent = 'Authenticating...';
        spinner.classList.remove('hidden');

        chrome.runtime.sendMessage({
          action: 'authenticate',
          username: email
        }, (response) => {
          console.log('üì® Authentication response:', response);
          
          if (response && response.success) {
            console.log('üéâ Authentication successful!');
            alert('Authentication successful! Extension is now active.');
            
            localStorage.setItem(
              'dummyUser',
              JSON.stringify({
                email,
                loginTime: new Date().toISOString(),
              })
            );
            
            // Reload to show logged in state
            location.reload();
          } else {
            console.log('‚ùå Authentication failed');
            alert('Authentication failed. Please try again.');
            loginBtn.disabled = false;
            btnText.textContent = 'Login';
            spinner.classList.add('hidden');
          }
        });
      } else {
        console.log('‚ùå Invalid credentials');
        alert('Invalid credentials. Please use:\nUsername: Travis Scott\nPassword: MBDTF');
      }
    });
  </script>
</body>
</html>